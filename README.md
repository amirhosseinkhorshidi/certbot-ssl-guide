# راهنمای ایجاد گواهینامه Wildcard SSL با استفاده از Certbot

این راهنما به شما کمک می‌کند تا Wildcard SSL برای دامین خود ایجاد کنید. Wildcard SSL یک گواهینامه SSL است که به شما امکان می‌دهد تا با استفاده از یک گواهینامه واحد، تمامی زیردامنه‌های یک دامنه اصلی را ایمن کنید. این نوع گواهینامه به ویژه برای وب‌سایت‌هایی که تعداد زیادی زیردامنه دارند، مفید است زیرا نیاز به خرید و مدیریت گواهینامه‌های جداگانه برای هر زیردامنه را برطرف می‌کند.

برای استفاده از بخش وایلدکارد، می‌توانید با استفاده از کاراکتر * (ستاره) به عنوان Wildcard برای تمامی زیردامنه‌ها یا یک زیردامنه خاص مانند dash.، گواهینامه را اعمال کنید. به عنوان مثال، اگر می‌خواهید تمامی ساب‌دامین‌ها را تحت پوشش قرار دهید، می‌توانید از رکورد * استفاده کنید و اگر فقط یک ساب‌دامین خاص مد نظر است، آن را به صورت کامل وارد کنید.
## پیش‌نیازها

قبل از اجرای دستور Certbot، مطمئن شوید که:
- دسترسی به سرور دارید و می‌توانید تنظیمات DNS را تغییر دهید.
- دامنه و زیر‌دامنه‌های مورد نظر شما ثبت شده و به سرور شما اشاره می‌کنند.

## دستور Certbot

دستور زیر برای ایجاد گواهینامه SSL برای دامنه `example.dev` و تمام زیر‌دامنه‌های آن (`*.example.dev`) استفاده می‌شود:

```bash
certbot certonly --manual -d example.dev -d *.example.dev --agree-tos --no-bootstrap --manual-public-ip-logging-ok --preferred-challenges dns-01 --server https://acme-v02.api.letsencrypt.org/directory
```

### توضیحات دستورات

این دستور با استفاده از **`certbot certonly`** تنها گواهینامه SSL را ایجاد می‌کند و تغییری در تنظیمات سرور وب اعمال نمی‌کند که برای نصب دستی گواهینامه مناسب است. گزینه **`--manual`** به Certbot می‌گوید که فرآیند احراز هویت را به صورت دستی انجام دهد، بنابراین باید رکوردهای DNS مورد نیاز را خودتان اضافه کنید. با استفاده از **`-d example.dev -d *.example.dev`**، دامنه‌های مورد نظر برای صدور گواهینامه مشخص می‌شوند که در اینجا شامل دامنه اصلی و تمام زیر‌دامنه‌ها است. گزینه **`--agree-tos`** موافقت شما با شرایط استفاده از Let's Encrypt را نشان می‌دهد. **`--no-bootstrap`** از نصب خودکار بسته‌های مورد نیاز توسط Certbot جلوگیری می‌کند، که در شرایطی که وابستگی‌ها از قبل نصب شده‌اند مفید است. **`--manual-public-ip-logging-ok`** اجازه می‌دهد که IP عمومی سرور شما در لاگ‌های عمومی ثبت شود، که برای درخواست‌های دستی رایج است. گزینه **`--preferred-challenges dns-01`** Certbot را مجبور می‌کند تا از چالش DNS-01 برای احراز هویت دامنه استفاده کند که نیازمند اضافه کردن رکورد TXT به تنظیمات DNS دامنه است. در نهایت، **`--server https://acme-v02.api.letsencrypt.org/directory`** سرور ACME مورد استفاده Certbot را مشخص می‌کند، که در اینجا سرور اصلی Let's Encrypt انتخاب شده است.

## مراحل ایجاد گواهینامه

۱. **اجرای دستور Certbot**: ابتدا دستور Certbot را که در بخش قبلی توضیح داده شد، اجرا کنید. این دستور، فرآیند ایجاد گواهینامه SSL را آغاز می‌کند.

۲. **دریافت و اضافه کردن رکورد DNS**: پس از اجرای دستور، Certbot یک رشته‌ی منحصر به فرد (Token) را به شما می‌دهد. این رشته باید به عنوان یک رکورد متنی (TXT) در تنظیمات DNS دامنه‌ی شما اضافه شود. این مرحله به عنوان بخشی از فرآیند احراز هویت استفاده می‌شود تا Certbot تأیید کند که شما مالک دامنه هستید. به کنسول مدیریت DNS خود بروید و رکورد TXT را دقیقاً با اطلاعات داده شده توسط Certbot اضافه کنید.

۳. **انتشار و تأیید رکورد DNS**: پس از اضافه کردن رکورد TXT، صبر کنید تا تغییرات DNS شما به طور کامل در سراسر اینترنت منتشر شود. این فرآیند ممکن است چند دقیقه تا چند ساعت طول بکشد. بعد از انتشار، به پنجره ترمینال بازگردید و به Certbot اجازه دهید تا عملیات احراز هویت را ادامه دهد. Certbot رکورد DNS را بررسی می‌کند تا از صحت آن اطمینان حاصل کند.

۴. **ایجاد و نصب گواهینامه SSL**: اگر عملیات احراز هویت موفقیت‌آمیز باشد، Certbot گواهینامه SSL شما را ایجاد می‌کند. گواهینامه و کلید خصوصی مربوطه در سیستم شما ذخیره می‌شوند. اکنون می‌توانید این گواهینامه را در وب سرور خود (مانند Nginx یا Apache) پیکربندی کنید.

## اعتبار گواهینامه

گواهینامه صادر شده توسط Let's Encrypt به مدت ۹۰ روز اعتبار دارد. بهتر است پیش از پایان اعتبار آن، گواهینامه را تمدید کنید. می‌توانید این کار را به صورت خودکار با Certbot انجام دهید.

## تمدید گواهینامه

برای تمدید گواهینامه، می‌توانید مجدداً از همان دستور Certbot استفاده کنید یا از دستوری مشابه به زیر استفاده کنید:

```bash
certbot renew
```
